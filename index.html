<!DOCTYPE html>
<html>
<head>
  <script src="http://code.jquery.com/jquery-latest.js"></script>
</head>
<body>
  <div id="nav" style="display:inline; float:left">
  <a href="javascript:newFile('HelloAndroid/res/layout')">New XML layout file</a><br>
  <a href="javascript:newFile('HelloAndroid/res/values')">New XML values file</a><br>
  <a href="javascript:newFile('HelloAndroid/src/com/example/helloandroid')">New java file</a>
  </div>
  <form action="saysomething.cgi" id="codeForm" method="post" style="display:inline">
   <textarea name="code" rows="50" cols="50" id="code" style="display:inline"></textarea>
   <input type="submit" value="Submit" />
  </form>
  <!-- the result of the search will be rendered inside this div -->
  <div id="result"></div>

<script>
  var fileNames = new Array();
  var fileContents = new Array();
  
  /* attach a submit handler to the form */
  $("#codeForm").submit(function(event) {
    /* stop form from submitting normally */
    event.preventDefault(); 
    
    fileContents[currFile] = $("#code").val();
        
    /* get some values from elements on the page: */
    var $form = $( this ),
        term = $form.find( 'textarea[name="code"]' ).val(),
        url = $form.attr( 'action' );

    /* Send the data using post and put the results in a div */
    $.post(url, { 'fileNames[]': fileNames, 'fileContents[]': fileContents } ,
      function( data ) {
          $( "#result" ).empty().append( data );
      }
    );
  });
   
  $.getJSON('listfiles.cgi', function(data) {
    $.each(data.results, function(key, value) {
        window.console.log(value);
      $("#nav").append("<ul>" + makeListFromDir(value) + "</ul>");
    });
    
    startImport();
  });
  
  function makeListFromDir(dir) {
    html = "<li>" + dir.dir + "</li><ul>";
    $.each(dir.children, function(key, value) {
        if (value.children != undefined) {
            html += makeListFromDir(value, html);
        }
        else {
            html += '<li><a href="javascript:changeTab(' + fileNames.length +')">' + value + '</a></li>';
            fileNames.push(dir.dir + "/" + value);
        }
    });
    html += "</ul>";
    return html;
  }
  
  function startImport() {
        for(i = 0; i < fileNames.length; i++) {
        (function(i) {
            $.get(fileNames[i], function(data, status) {
                importData(data, status, i);
            }, "text");
        })(i);
      }
  }
  
  function importData(data, status, i) {
    fileContents[i] = data;
    if (i == 0) $("#code").val(data);
  };
  
  var currFile = 0;
  
  function changeTab(src) {
    fileContents[currFile] = $("#code").val();
    currFile = src;
    $("#code").val(fileContents[currFile]);
  }

  function newFile(dir, ext) {
    var fileName = prompt("Name your file (include extension)");
    html = '<li><a href="javascript:changeTab(' + fileNames.length +')">' + fileName + '</a></li>';
    fileNames.push(dir + "/" + fileName);
    fileContents.push("");
    $("li:contains(" + dir + ")").next().append(html);
  }
</script>

</body>
</html>
